<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Titcoin Overlay Studio</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: white;
      text-align: center;
    }
    h1 {
      margin: 20px 0 10px;
      color: orange;
      text-shadow: 0 0 10px #ffa500;
    }
    #dropzone {
      border: 3px dashed orange;
      border-radius: 10px;
      padding: 30px;
      margin: 20px auto;
      width: 90%;
      max-width: 500px;
      color: white;
    }
    #canvasContainer {
      display: flex;
      justify-content: center;
      margin: 20px auto;
      padding: 10px;
      border-radius: 15px;
      border: 3px solid orange;
      box-shadow: 0 0 20px orange;
      max-width: 95vw;
    }
    canvas {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }
    .buttons {
      margin: 20px 0;
    }
    button {
      background-color: orange;
      color: black;
      font-weight: bold;
      padding: 10px 20px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <img src="https://res.cloudinary.com/dmwmvmg3o/image/upload/v1751927485/titcoinWHT_ckbgfw.png" style="width:60px; margin-top:20px;" />
  <h1>Titcoin Overlay Studio</h1>

  <div id="dropzone">Tap or Drag an Image Here to Upload</div>

  <div id="canvasContainer">
    <canvas id="c"></canvas>
  </div>

  <div class="buttons">
    <button onclick="swapOverlay()">Swap Overlay</button>
    <button onclick="download()">Download Final Image</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <script>
    const canvas = new fabric.Canvas('c');
    const dropzone = document.getElementById('dropzone');
    let uploadedImg, overlay1, overlay2, activeOverlay = 1;

    const overlayURL1 = "https://res.cloudinary.com/dmwmvmg3o/image/upload/v1751927485/titcoinWHT_ckbgfw.png";
    const overlayURL2 = "https://res.cloudinary.com/dmwmvmg3o/image/upload/v1751927506/titcoinBLK2_vgn80i.png";

    dropzone.addEventListener("dragover", e => e.preventDefault());
    dropzone.addEventListener("drop", e => {
      e.preventDefault();
      handleFile(e.dataTransfer.files[0]);
    });
    dropzone.addEventListener("click", () => {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";
      input.onchange = e => handleFile(e.target.files[0]);
      input.click();
    });

    function handleFile(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        fabric.Image.fromURL(e.target.result, function(img) {
          uploadedImg = img;

          // Get screen DPI multiplier
          const multiplier = window.innerWidth < 768 ? 2 : 1;

          // Resize canvas to match image
          const newWidth = img.width;
          const newHeight = img.height;
          canvas.setWidth(newWidth);
          canvas.setHeight(newHeight);

          // Remove everything and add image scaled to fit (contain)
          canvas.clear();
          const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
          img.set({ scaleX: scale, scaleY: scale, selectable: false, evented: false });
          canvas.add(img);
          canvas.centerObject(img);

          addOverlay(); // Add overlay after image
        });
      };
      reader.readAsDataURL(file);
    }

    function addOverlay() {
      const url = activeOverlay === 1 ? overlayURL1 : overlayURL2;
      fabric.Image.fromURL(url, function(overlay) {
        overlay.set({
          left: canvas.width / 2,
          top: canvas.height / 2,
          originX: "center",
          originY: "center",
          scaleX: canvas.width / overlay.width,
          scaleY: canvas.height / overlay.height,
          selectable: false,
          evented: false
        });
        if (activeOverlay === 1) {
          overlay1 = overlay;
        } else {
          overlay2 = overlay;
        }
        canvas.add(overlay);
        canvas.renderAll();
      });
    }

    function swapOverlay() {
      if (!overlay1 || !overlay2) return;
      canvas.remove(activeOverlay === 1 ? overlay1 : overlay2);
      activeOverlay = activeOverlay === 1 ? 2 : 1;
      addOverlay();
    }

    function download() {
      const isMobile = window.innerWidth < 768;
      const scale = isMobile ? 2 : 1;
      const dataURL = canvas.toDataURL({
        format: 'png',
        multiplier: scale
      });
      const link = document.createElement('a');
      link.download = 'titcoin-overlay.png';
      link.href = dataURL;
      link.click();
    }
  </script>
</body>
</html>
